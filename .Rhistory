theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_chum_C <- plot_sst_effect_manuscript(posterior = ric_chm_cpd_ocean_covariates_logR,
effect = "sst", species = "chum",
model = "Sea-surface temperature",
xlim = c(-0.5, 0.5))+
theme(legend.position = "none")+
labs(y = "Posterior density")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_chum_D <- plot_npgo_effect_manuscript(posterior = ric_chm_cpd_ocean_covariates_logR,
effect = "npgo", species = "chum",
model = "North Pacific Gyre Oscillation",
xlim = c(-0.5, 0.5))+
theme(legend.position = "none")+
labs(y = "Posterior density")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
((plot_chum_A / plot_chum_B / plot_chum_C / plot_chum_D)+ plot_layout(axes = 'collect') |
((plot_chum_E  / plot_chum_F ) + plot_layout(axes = 'collect')) ) + plot_layout(widths = c(1.7,1))
plot_pink_G <- plot_forestry_effect_manuscript(posterior = ric_pk_cpd_ersst,
effect = "cpd", species = "pink",
# model = "Ricker model with CPD", xlim = c(-1, 1))
model = "Cumulative disturbance", xlim = c(-0.5, 0.5))+
theme(legend.position = "none")+
labs(y = "Posterior density")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_pink_H <- plot_forestry_effect_manuscript(posterior = ric_pk_eca_ersst,
effect = "eca", species = "pink",
# model = "Ricker model with ECA", xlim = c(-1, 1))
model = "Equivalent clearcut area", xlim = c(-0.5, 0.5))+
theme(legend.position = "none")+
labs(y = "Posterior density")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_pink_I <- plot_sst_effect_manuscript(posterior = ric_pk_cpd_ersst,
effect = "sst", species = "pink",
# model = "Ricker model with CPD",
model = "Sea-surface temperature",
# xlim = c(-1, 1))
xlim = c(-0.5, 0.5))+
labs(y = "Posterior density")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_pink_J <- plot_npgo_effect_manuscript(posterior = ric_pk_cpd_ersst,
effect = "npgo", species = "pink",
# model = "Ricker model with CPD",
model = "North Pacific Gyre Oscillation",
# xlim = c(-1, 1))
xlim = c(-0.5, 0.5))+
labs(y = "Posterior density")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_pink_K <- plot_productivity_decline_manuscript(posterior = ric_pk_cpd_ersst,
species = "pink",
effect = "cpd",
# model = "Ricker model with CPD")
model = "", hd = TRUE)+
ylim(c(-75,75))+
labs(y = "Change in recruitment (%)")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_pink_L <- plot_productivity_decline_manuscript(posterior = ric_pk_eca_ersst,
species = "pink",
effect = "eca",
# model = "Ricker model with ECA")
model = "", hd = TRUE)+
ylim(c(-75,75))+
labs(y = "Change in recruitment (%)")+
theme(axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10))
plot_pink2 <- ((plot_pink_G / plot_pink_H / plot_pink_I / plot_pink_J)+ plot_layout(axes = 'collect') |
((plot_pink_K  / plot_pink_L ) + plot_layout(axes = 'collect'))) + plot_layout(widths = c(1.7,1))
plot_pink2
(wrap_elements(panel = plot_chum2 + plot_annotation(tag_levels = list(c('A','B','C','D','I','J')),
title = "Chum salmon")&
theme(plot.tag = element_text(size = 8))))
(wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
title = "Pink salmon")&
theme(plot.tag = element_text(size = 8))))
(wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
title = "Pink salmon")&
theme(plot.tag.position = c(0, 1),
plot.tag = element_text(size = 8, hjust = 0, vjust = 0))))
(wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
title = "Pink salmon")&
theme(plot.tag.position = c(0.2, 1),
plot.tag = element_text(size = 8, hjust = 0, vjust = 0))))
(wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
title = "Pink salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 8, hjust = 0, vjust = 0))))
(wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold"))))
(wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
# tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold"))))
plot_pink_chum_w_title2 <- ((wrap_elements(panel = plot_chum2 + plot_annotation(tag_levels = list(c('A','B','C','D','I','J')),
title = "Chum salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))) / (wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
# tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold"))))) +
plot_pink_chum_w_title2
plot_chum2 <- ((plot_chum_A / plot_chum_B / plot_chum_C / plot_chum_D)+ plot_layout(axes = 'collect') |
((plot_chum_E  / plot_chum_F ) + plot_layout(axes = 'collect')) ) + plot_layout(widths = c(1.7,1))
plot_pink_chum_w_title2 <- ((wrap_elements(panel = plot_chum2 + plot_annotation(tag_levels = list(c('A','B','C','D','I','J')),
title = "Chum salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))) / (wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
# tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold"))))) +
plot_pink_chum_w_title2
plot_pink_chum_w_title2 <- ((wrap_elements(panel = plot_chum2 + plot_annotation(tag_levels = list(c('A','B','C','D','I','J')),
title = "Chum salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))) / (wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
# tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold"))))) +
plot_pink_chum_w_title2
plot_pink_chum_w_title2 <- ((wrap_elements(panel = plot_chum2 + plot_annotation(tag_levels = list(c('A','B','C','D','I','J')),
title = "Chum salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))) / (wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
# tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.1, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))))
plot_pink_chum_w_title2
ggsave(here('figures','manuscript_dec2025_chum_pink_ricker_only_w_hd_CI.png'),
plot = plot_pink_chum_w_title2,
width = 8,
height = 12,
units = 'in',
dpi = 500)
plot_pink_chum_w_title2 <- ((wrap_elements(panel = plot_chum2 + plot_annotation(tag_levels = list(c('A','B','C','D','I','J')),
title = "Chum salmon")&
theme(plot.tag.position = c(0.075, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))) / (wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
# tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.075, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))))
plot_pink_chum_w_title2
ggsave(here('figures','manuscript_dec2025_chum_pink_ricker_only_w_hd_CI.png'),
plot = plot_pink_chum_w_title2,
width = 8,
height = 12,
units = 'in',
dpi = 500)
plot_pink_chum_w_title2 <- ((wrap_elements(panel = plot_chum2 + plot_annotation(tag_levels = list(c('A','B','C','D','I','J')),
title = "Chum salmon")&
theme(plot.tag.position = c(0.05, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))) / (wrap_elements(panel = plot_pink2+
plot_annotation(tag_levels = list(c('E','F','G','H','K','L')),
# tag_suffix = ')',
title = "Pink salmon")&
theme(plot.tag.position = c(0.05, 1),
plot.tag = element_text(size = 10, hjust = 0, vjust = 0, face = "bold")))))
ggsave(here('figures','manuscript_dec2025_chum_pink_ricker_only_w_hd_CI.png'),
plot = plot_pink_chum_w_title2,
width = 8,
height = 12,
units = 'in',
dpi = 500)
productivity_decline_cu_df <- function(posterior, effect, species){
if(species == "chum"){
df <- ch20rsc
} else if(species == "pink"){
df <- pk10r
}
full_productivity <- NULL
for (i in 1:length(unique(df$CU_n))){
cu <- unique(df$CU_n)[i]
cu_data <- df %>% filter(CU_n == cu)
b_cu <- posterior %>% select(starts_with("b_for_cu")) %>%
select(ends_with(paste0("[",cu,"]")))
eca_sqrt_std_cu <- max(cu_data$sqrt.ECA.std)
#minimum forestry possible -0
eca_cu <- max(cu_data$ECA_age_proxy_forested_only)
forestry_eca <- seq(0,1, length.out = 100)
# cpd_sqrt_std_cu <- max(cu_data$sqrt.CPD.std) # should not be using max from CU
#minimum forestry possible - 0
cpd_cu <- cu_data %>% group_by(River) %>%
filter(disturbedarea_prct_cs == max(disturbedarea_prct_cs)) %>%
distinct(disturbedarea_prct_cs) %>%
ungroup %>%
summarize(mean = mean(disturbedarea_prct_cs))
cpd_sqrt_std_cu <- cu_data %>% group_by(River) %>%
filter(sqrt.CPD.std == max(sqrt.CPD.std)) %>%
distinct(sqrt.CPD.std) %>%
ungroup %>%
summarize(mean = mean(sqrt.CPD.std))
forestry_cpd <- seq(0,100, length.out = 100)
#to calculate no forestry in the standardized scale
forestry_sqrt <- sqrt(forestry_cpd)
forestry_sqrt_std = (forestry_sqrt-mean(forestry_sqrt))/sd(forestry_sqrt)
no_forestry <- min(forestry_sqrt_std)
productivity <- (exp(as.matrix(b_cu[,1])%*%
(cpd_sqrt_std_cu$mean-no_forestry)))*100 - 100
productivity_median <- apply(productivity,2,median)
productivity_median_df <- data.frame(CU = unique(cu_data$CU_name),
productivity_50 = apply(productivity,2,median),
productivity_25 = apply(productivity,2,quantile, probs = 0.25),
productivity_75 = apply(productivity,2,quantile, probs = 0.75),
productivity_025 = apply(productivity,2,quantile, probs = 0.025),
productivity_975 = apply(productivity,2,quantile, probs = 0.975),
productivity_025_hdi = apply(productivity,2, hdi, ci = 0.95)[[1]]$CI_low,
productivity_975_hdi = apply(productivity,2, hdi, ci = 0.95)[[1]]$CI_high,
forestry = cpd_cu$mean,
CU_n = unique(cu_data$CU_n))
full_productivity <- rbind(full_productivity, productivity_median_df)
}
return(full_productivity)
}
ric_chm_cpd_productivity_decline_cu <- productivity_decline_cu_df(ric_chm_cpd_ocean_covariates_logR,
effect = "cpd", species = "chum")
cu_forest_plot_compare <- ric_chm_cpd_productivity_decline_cu %>%
arrange(desc(productivity_50)) %>%
mutate(CU2 = factor(CU, levels = CU)) %>%
ggplot(aes(x = CU, y = productivity_50)) +
geom_point(aes(y = productivity_50, x = CU2), color = '#516479',fill = "white", size = 3, alpha = 0.5) +
geom_errorbar(aes(ymin = productivity_025, ymax = productivity_975, color = "95% ET\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_025_hdi, ymax = productivity_975_hdi, color = "95% HD\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_25, ymax = productivity_75, color = '50% ET\ncredible interval'), width = 0, alpha = 0.7, size = 2) +
scale_color_manual(name = '', values = c('95% ET\ncredible interval' = '#516479',
'50% ET\ncredible interval' = '#516479',
'95% HD\ncredible interval' = '#C8EAD3'))+
#add estimated median decline to the right of each error bar
geom_text(aes(label = paste(round(productivity_50,1),"%")),
hjust = -0.25,
vjust = -0.35,
size = 3, color = "gray20") +
#add dashed v line
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
#label the 95%credible interval using annotate
coord_flip() +
# scale_color_manual(name = 'Model type', values = c('independent alpha' = 'cadetblue', 'hierarchical alpha' = 'coral', 'hierarchical alpha - ricker' = 'darkgoldenrod')) +
labs(#title = 'Estimated percent change in CU-level productivity',
x = 'Conservation Unit',
y = 'Change in recruitment (%)') +
theme_classic() +
theme(legend.position = c(0.8,0.9),
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 18),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
panel.background = element_rect(fill='transparent'),
plot.background = element_rect(fill='transparent', color=NA),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.background = element_rect(fill='transparent', color = "transparent"),
legend.box.background = element_rect(fill='transparent', color = 'transparent'))+
#increase xlim
scale_x_discrete(expand = expansion(mult = 0.05))
cu_forest_plot_compare
productivity_decline_cu_df <- function(posterior, effect, species){
if(species == "chum"){
df <- ch20rsc
} else if(species == "pink"){
df <- pk10r
}
full_productivity <- NULL
for (i in 1:length(unique(df$CU_n))){
cu <- unique(df$CU_n)[i]
cu_data <- df %>% filter(CU_n == cu)
b_cu <- posterior %>% select(starts_with("b_for_cu")) %>%
select(ends_with(paste0("[",cu,"]")))
eca_sqrt_std_cu <- max(cu_data$sqrt.ECA.std)
#minimum forestry possible -0
eca_cu <- max(cu_data$ECA_age_proxy_forested_only)
forestry_eca <- seq(0,1, length.out = 100)
# cpd_sqrt_std_cu <- max(cu_data$sqrt.CPD.std) # should not be using max from CU
#minimum forestry possible - 0
cpd_cu <- cu_data %>% group_by(River) %>%
filter(disturbedarea_prct_cs == max(disturbedarea_prct_cs)) %>%
distinct(disturbedarea_prct_cs) %>%
ungroup %>%
summarize(mean = mean(disturbedarea_prct_cs))
cpd_sqrt_std_cu <- cu_data %>% group_by(River) %>%
filter(sqrt.CPD.std == max(sqrt.CPD.std)) %>%
distinct(sqrt.CPD.std) %>%
ungroup %>%
summarize(mean = mean(sqrt.CPD.std))
forestry_cpd <- seq(0,100, length.out = 100)
#to calculate no forestry in the standardized scale
forestry_sqrt <- sqrt(forestry_cpd)
forestry_sqrt_std = (forestry_sqrt-mean(forestry_sqrt))/sd(forestry_sqrt)
no_forestry <- min(forestry_sqrt_std)
productivity <- (exp(as.matrix(b_cu[,1])%*%
(cpd_sqrt_std_cu$mean-no_forestry)))*100 - 100
productivity_median <- apply(productivity,2,median)
productivity_median_df <- data.frame(CU = unique(cu_data$CU_name),
productivity_50 = apply(productivity,2,median),
productivity_25 = apply(productivity,2,quantile, probs = 0.25),
productivity_75 = apply(productivity,2,quantile, probs = 0.75),
productivity_025 = apply(productivity,2,quantile, probs = 0.025),
productivity_975 = apply(productivity,2,quantile, probs = 0.975),
productivity_025_hdi = apply(productivity,2, hdi, ci = 0.95)[[1]]$CI_low,
productivity_975_hdi = apply(productivity,2, hdi, ci = 0.95)[[1]]$CI_high,
productivity_25_hdi = apply(productivity,2, hdi, ci = 0.5)[[1]]$CI_low,
productivity_75_hdi = apply(productivity,2, hdi, ci = 0.5)[[1]]$CI_high,
forestry = cpd_cu$mean,
CU_n = unique(cu_data$CU_n))
full_productivity <- rbind(full_productivity, productivity_median_df)
}
return(full_productivity)
}
ric_chm_cpd_productivity_decline_cu <- productivity_decline_cu_df(ric_chm_cpd_ocean_covariates_logR,
effect = "cpd", species = "chum")
cu_forest_plot_compare <- ric_chm_cpd_productivity_decline_cu %>%
arrange(desc(productivity_50)) %>%
mutate(CU2 = factor(CU, levels = CU)) %>%
ggplot(aes(x = CU, y = productivity_50)) +
geom_point(aes(y = productivity_50, x = CU2), color = '#516479',fill = "white", size = 3, alpha = 0.5) +
geom_errorbar(aes(ymin = productivity_025, ymax = productivity_975, color = "95% ET\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_025_hdi, ymax = productivity_975_hdi, color = "95% HD\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_25_hdi, ymax = productivity_75_hdi, color = "50% HD\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_25, ymax = productivity_75, color = '50% ET\ncredible interval'), width = 0, alpha = 0.7, size = 2) +
scale_color_manual(name = '', values = c('95% ET\ncredible interval' = '#516479',
'50% ET\ncredible interval' = '#516479',
'95% HD\ncredible interval' = '#C8EAD3',
'50% HD\ncredible interval' = '#C8EAD3'))+
#add estimated median decline to the right of each error bar
geom_text(aes(label = paste(round(productivity_50,1),"%")),
hjust = -0.25,
vjust = -0.35,
size = 3, color = "gray20") +
#add dashed v line
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
#label the 95%credible interval using annotate
coord_flip() +
# scale_color_manual(name = 'Model type', values = c('independent alpha' = 'cadetblue', 'hierarchical alpha' = 'coral', 'hierarchical alpha - ricker' = 'darkgoldenrod')) +
labs(#title = 'Estimated percent change in CU-level productivity',
x = 'Conservation Unit',
y = 'Change in recruitment (%)') +
theme_classic() +
theme(legend.position = c(0.8,0.9),
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 18),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
panel.background = element_rect(fill='transparent'),
plot.background = element_rect(fill='transparent', color=NA),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.background = element_rect(fill='transparent', color = "transparent"),
legend.box.background = element_rect(fill='transparent', color = 'transparent'))+
#increase xlim
scale_x_discrete(expand = expansion(mult = 0.05))
cu_forest_plot_compare
cu_forest_plot_compare <- ric_chm_cpd_productivity_decline_cu %>%
arrange(desc(productivity_50)) %>%
mutate(CU2 = factor(CU, levels = CU)) %>%
ggplot(aes(x = CU, y = productivity_50)) +
geom_point(aes(y = productivity_50, x = CU2), color = '#516479',fill = "white", size = 3, alpha = 0.5) +
# geom_errorbar(aes(ymin = productivity_025, ymax = productivity_975, color = "95% ET\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_025_hdi, ymax = productivity_975_hdi, color = "95% HD\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_25_hdi, ymax = productivity_75_hdi, color = "50% HD\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
# geom_errorbar(aes(ymin = productivity_25, ymax = productivity_75, color = '50% ET\ncredible interval'), width = 0, alpha = 0.7, size = 2) +
scale_color_manual(name = '', values = c('95% ET\ncredible interval' = '#516479',
'50% ET\ncredible interval' = '#516479',
'95% HD\ncredible interval' = '#C8EAD3',
'50% HD\ncredible interval' = '#C8EAD3'))+
#add estimated median decline to the right of each error bar
geom_text(aes(label = paste(round(productivity_50,1),"%")),
hjust = -0.25,
vjust = -0.35,
size = 3, color = "gray20") +
#add dashed v line
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
#label the 95%credible interval using annotate
coord_flip() +
# scale_color_manual(name = 'Model type', values = c('independent alpha' = 'cadetblue', 'hierarchical alpha' = 'coral', 'hierarchical alpha - ricker' = 'darkgoldenrod')) +
labs(#title = 'Estimated percent change in CU-level productivity',
x = 'Conservation Unit',
y = 'Change in recruitment (%)') +
theme_classic() +
theme(legend.position = c(0.8,0.9),
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 18),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
panel.background = element_rect(fill='transparent'),
plot.background = element_rect(fill='transparent', color=NA),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.background = element_rect(fill='transparent', color = "transparent"),
legend.box.background = element_rect(fill='transparent', color = 'transparent'))+
#increase xlim
scale_x_discrete(expand = expansion(mult = 0.05))
cu_forest_plot_compare
cu_forest_plot_compare <- ric_chm_cpd_productivity_decline_cu %>%
arrange(desc(productivity_50)) %>%
mutate(CU2 = factor(CU, levels = CU)) %>%
ggplot(aes(x = CU, y = productivity_50)) +
geom_point(aes(y = productivity_50, x = CU2), color = '#516479',fill = "white", size = 3, alpha = 0.5) +
# geom_errorbar(aes(ymin = productivity_025, ymax = productivity_975, color = "95% ET\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_025_hdi, ymax = productivity_975_hdi, color = "95% HD\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_25_hdi, ymax = productivity_75_hdi, color = "50% HD\ncredible interval"), width = 0, alpha = 0.7, size = 2) +
# geom_errorbar(aes(ymin = productivity_25, ymax = productivity_75, color = '50% ET\ncredible interval'), width = 0, alpha = 0.7, size = 2) +
scale_color_manual(name = '', values = c('95% ET\ncredible interval' = '#516479',
'50% ET\ncredible interval' = '#516479',
'95% HD\ncredible interval' = '#C8EAD3',
'50% HD\ncredible interval' = '#C8EAD3'))+
#add estimated median decline to the right of each error bar
geom_text(aes(label = paste(round(productivity_50,1),"%")),
hjust = -0.25,
vjust = -0.35,
size = 3, color = "gray20") +
#add dashed v line
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
#label the 95%credible interval using annotate
coord_flip() +
# scale_color_manual(name = 'Model type', values = c('independent alpha' = 'cadetblue', 'hierarchical alpha' = 'coral', 'hierarchical alpha - ricker' = 'darkgoldenrod')) +
labs(#title = 'Estimated percent change in CU-level productivity',
x = 'Conservation Unit',
y = 'Change in recruitment (%)') +
theme_classic() +
theme(legend.position = c(0.8,0.9),
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 18),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
panel.background = element_rect(fill='transparent'),
plot.background = element_rect(fill='transparent', color=NA),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.background = element_rect(fill='transparent', color = "transparent"),
legend.box.background = element_rect(fill='transparent', color = 'transparent'))+
#increase xlim
scale_x_discrete(expand = expansion(mult = 0.05))
cu_forest_plot_compare
cu_forest_plot_compare <- ric_chm_cpd_productivity_decline_cu %>%
arrange(desc(productivity_50)) %>%
mutate(CU2 = factor(CU, levels = CU)) %>%
ggplot(aes(x = CU, y = productivity_50)) +
geom_point(aes(y = productivity_50, x = CU2), color = '#516479',fill = "white", size = 3, alpha = 0.5) +
# geom_errorbar(aes(ymin = productivity_025, ymax = productivity_975, color = "95% ET\ncredible interval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_025_hdi, ymax = productivity_975_hdi, color = "95% credible\ninterval"), width = 0, alpha = 0.5, size = 1) +
geom_errorbar(aes(ymin = productivity_25_hdi, ymax = productivity_75_hdi, color = "50% credible\ninterval"), width = 0, alpha = 0.7, size = 2) +
# geom_errorbar(aes(ymin = productivity_25, ymax = productivity_75, color = '50% ET\ncredible interval'), width = 0, alpha = 0.7, size = 2) +
scale_color_manual(name = '', values = c('95% credible\ninterval' = '#516479',
'50% credible\ninterval' = '#516479'))+
#add estimated median decline to the right of each error bar
geom_text(aes(label = paste(round(productivity_50,1),"%")),
hjust = -0.25,
vjust = -0.35,
size = 3, color = "gray20") +
#add dashed v line
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
#label the 95%credible interval using annotate
coord_flip() +
# scale_color_manual(name = 'Model type', values = c('independent alpha' = 'cadetblue', 'hierarchical alpha' = 'coral', 'hierarchical alpha - ricker' = 'darkgoldenrod')) +
labs(#title = 'Estimated percent change in CU-level productivity',
x = 'Conservation Unit',
y = 'Change in recruitment (%)') +
theme_classic() +
theme(legend.position = c(0.8,0.9),
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 18),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
panel.background = element_rect(fill='transparent'),
plot.background = element_rect(fill='transparent', color=NA),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.background = element_rect(fill='transparent', color = "transparent"),
legend.box.background = element_rect(fill='transparent', color = 'transparent'))+
#increase xlim
scale_x_discrete(expand = expansion(mult = 0.05))
cu_forest_plot_compare
ggsave(here("figures","manuscript_dec2025_chum_ricker_cpd_productivity_decline_by_cu_forest_plot_hd_intervals.png"),
cu_forest_plot_compare, width = 5, height = 6, bg = "white")
cu_forest_plot_compare
ric_chm_cpd_productivity_decline_cu
ric_chm_cpd_productivity_decline_cu %>%
arrange(desc(productivity_50)) %>%
mutate(CU2 = factor(CU, levels = CU))
